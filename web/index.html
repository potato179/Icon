<!DOCTYPE html>
<html lang = "en">
    <head>
        <meta charset = "UTF-8">
        <meta name = "viewport" content = "width=device-width, initial-scale=1.0">
        <title>main</title>
        <link rel = "icon" href = "./img/dimigoLogo.png">
        <script type = "text/javascript" src = "https://code.jquery.com/jquery-1.12.4.min.js"></script>
        <link rel = "stylesheet" href = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity = "sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin = "anonymous">
        <link href = "https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel = "stylesheet" integrity = "sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin = "anonymous">
        <script src = "https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity = "sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin = "anonymous"></script>
        <script src = "https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity = "sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin = "anonymous"></script>
        <script src = "https://kit.fontawesome.com/06fb83cb17.js" crossorigin = "anonymous"></script>
        <link rel = "preconnect" href = "https://fonts.googleapis.com"> 
        <link rel = "preconnect" href = "https://fonts.gstatic.com" crossorigin> 
        <link href = "https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@700&display=swap" rel = "stylesheet">
        <link rel = "stylesheet" href = "https://potato179.github.io/style/potato-min.css">
    </head>
    <body onload = "onbodyload();">
        <header class="p-3 bg-light">
            <div class = "container">
                <div class = "navbar navbar-expand-md navbar-dark fixed-top bg-light">
                    <div class = "container">
                        <a href="/" class="d-flex align-items-center mb-2 mb-lg-0 text-white text-decoration-none">
                            <img src = "./public/img/symbol.png" style = "width: 67px;">
                        </a>
                
                        <ul style = "margin-left: 29px;" class = "nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                            <li><a style = "font-size: 24px; color: #4FAF5A;" href = "./index.html" class = "nav-link">홈</a></li>
                            <li><a style = "font-size: 24px; color: #666666;" href = "./index.html" class = "nav-link">아이디어</a></li>
                            <li><a style = "font-size: 24px; color: #666666;" href = "./index.html" class = "nav-link">투자</a></li>
                            <li><a style = "font-size: 24px; color: #666666;" href = "./index.html" class = "nav-link">펀딩</a></li>
                        </ul>
                
                        <form class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search" style = "background: linear-gradient(271.52deg, #D9D9D9 -4.33%, #F5F5F5 -4.32%, #D9D9D9 109.72%);
                        box-shadow: inset 3px 3px 4px rgba(0, 0, 0, 0.15);
                        border-radius: 38.5px;">
                            <input type = "search" style = "background: transparent; border: none;" placeholder="Search..." aria-label="Search">
                            <button style = "background-color: transparent;"><img src = "./public/img/img_search.png" style = "width: 21px;"></button>
                        </form>
                
                        <div class="text-end">
                            <a style = "font-size: 24px; color: #666666;" id = "log_in_out" href = "./login.html">로그인</a>
                            <a style = "font-size: 24px; color: #666666;" id = "btn_join" href = "./join.html">회원가입</a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <img style = "height: 700px;" src = "./public/img/bannerbg.png">

        <div style = "margin-top: 200px; width: 100%; text-align: center;">
            <h1>서비스</h1><br><br>
            <h4>일상에서의 불편함을 해결하는 발명들로 이루는 삶의 질 향상</h4><br><br>
            <h4>청소년들에게 창업에 대한 새로운 길 안내</h4><br><br>
            <h4>소비자들의 소비 방식에 새로움을 선사</h4><br><br>
        </div>

        <div style = "margin-top: 200px; width: 100%; text-align: center; background-color: #BFE5B9;">
            <h1>asdf</h1><br><br>
            <div style = "width: 300px;">
                <h1>IDEA</h1>
                <p></p>
            </div>
        </div>

        <button id = "writeitems" onclick = 'window.location.href = "writeitems.html"'>글쓰기</button>
        <div class = "container">
            <div class = "text-center">
            </footer>
        </div>

        <div id = "itemss">
        </div>
        <div id = "main">
            <div id = "view_q">

            </div>
            <table id = "q_table" class = "table">
                <thead>
                <tr>
                    <th scope = "col">#</th>
                    <th scope = "col">글쓴이</th>
                    <th scope = "col">질문</th>
                    <th scope = "col">상태</th>
                </tr>
                </thead>
                <tbody id = "q_list">
                </tbody>
            </table>
        </div>
        <script src = "../public/js/jquery.cookie.js"></script>
        <script>
            function onbodyload(){
                var userEmail = $.cookie("userEmail");
                if(userEmail != '' && userEmail != null){
                    console.log("쿠키 존재: " + userEmail);

                    $("#log_in_out").html("로그아웃");
                    $("#log_in_out").css("color", "#4fee30");
                    $("#log_in_out").attr("onclick", 'window.location.href = "logout"');
                    var username = $.cookie("username");
                    $("#btn_join").html(username);
                    var t = document.getElementById("btn_join");
                    t.style.color = "red";
                    $("#btn_join").attr("onclick", '');
                }
                else{
                    console.log("쿠키가 존재하지 않습니다");

                    $("#log_in_out").html("로그인");
                    $("#log_in_out").attr("onclick", 'window.location.href = "login.html"');
                }



                var ajaxData = { 
                    type: "GET", 
                    url : "get_itemss",
                    data: {}, 
                    dataType: "json", 
                    success :  function(data, status, xhr){
                        console.log(data);

                        
                        //$("#itemss").html("daflasdhfkadhfakds");
                        var tempStr = "";
                        data.forEach(function(item, index){
                            tempStr += "<tr onclick='Viewitems(" + item.id + ")'>";
                            tempStr += '<th scope = "row">' + item.id + '</th>';
                            tempStr += "<td>" + item.writer + "</td>";
                            tempStr += "<td>" + item.title + "</td>";
                            tempStr += "<td>" + item.state + "</td>";
                            tempStr += "</tr>"
                        });

                        $("#q_list").html(tempStr);

                    },
                    error: function(jqXHR, textStatus, errorThrown){
                    }
                };
                $.ajax(ajaxData);
            }

            function Viewitems(id){
                console.log(`질문: ` + id);

                var ajaxData = { 
                    type: "GET", 
                    url : "view_items",
                    data: {id: id}, 
                    dataType: "json", 
                    success: function(data, status, xhr){
                        $('#q_table').html("");

                        var items_info = "<br>제목: <input id='title' size=50 value='" + data.title + "'>" + "<br><br>";
                        items_info += "내용: <textarea id='context' rows=4 cols=100>" + data.context+ "</textarea>";
                        items_info += "<br><br><br><br><br>";
                        items_info += "<button onclick=window.location.href='/'>목록으로</button>";
                        items_info += `<button class = 'edit' onclick = edit(${data.id})>수정하기</button>`;
                        items_info += `<button class = 'delete' onclick = delete_items(${data.id})>삭제하기</button>`;
                        items_info += `<button class = 'delete' onclick = press_like(${data.id})>좋아요</button>`;
                        items_info += "<br><br><br><br><br>";
                        items_info += `댓글: <textarea id='comment' rows=3 cols=100>${data.comment}</textarea>`;
                        items_info += `<button class = 'comment' onclick = comment(${data.id})>댓글달기</button>`;
                        items_info += "<br><br><br><br><br>";
                        items_info += "좋아요 누른 사람: ";
                        items_info += `${data.likes}`;

                        if(data.comment != undefined){
                            var commentList = JSON.parse(data.comment);
                            if(commentList){
                                commentList.forEach(function(element, index){
                                    console.log(element);
                                    items_info += `<br><div>${element.name}: ${element.text}</div>`;
                                });
                            }
                        }

                        $('#view_q').html(items_info);
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                    }
                };
                $.ajax(ajaxData);
            }

            function edit(id){
                var c = $('#context').val();
                var ajaxData = { 
                    type: "GET", 
                    url : "modify_items",
                    data: {id: id, context: c}, 
                    dataType: "json", 
                    success: function(data, status, xhr){
                        console.log(data);
                        alert(data.message);
                        window.location.href = "index.html";
                    },
                    error: function(jqXHR, textStatus, errorThrown){
                    }
                };
                $.ajax(ajaxData);
            }

            function delete_items(id){
                var ajaxData = {
                    type: "GET",
                    url: "del",
                    data: {id: id},
                    dataType: "json",
                    success: function(data, status, xhr){
                        console.log(data)
                        alert(data.message);
                        window.location.href = "index.html";
                    }
                };
                $.ajax(ajaxData);
            }

            function comment(id){
                var comments = document.getElementById("comment").value;
                var ajaxData = {
                    type: "GET",
                    url: "write_comment",
                    data: {comments: comments, id: id, email: $.cookie("userEmail"), userName: $.cookie("username")},
                    dataType: "json",
                    success: function(data, status, xhr){
                        console.log(data)
                        alert(data.message);
                        window.location.href = "index.html";
                    }
                }
                $.ajax(ajaxData)
            }

            function press_like(id){
                var email = $.cookie("userEmail");
                if(!email) return alert("로그인이 필요합니다.");

                var ajaxData = { 
                    type: "GET", 
                    url : "press_like",
                    data: {id: id, email: $.cookie("userEmail")}, 
                    dataType: "json", 
                    success: function(data, status, xhr){
                        console.log(data)
                        alert(data.message);
                    }
                };

                $.ajax(ajaxData);
            }
        </script>
    </body>
</html>