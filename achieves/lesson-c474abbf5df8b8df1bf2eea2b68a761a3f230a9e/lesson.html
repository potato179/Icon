<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>main</title>
    <!--<link rel="stylesheet" href="./public/css/search.css">-->

    <link rel="stylesheet" href="./public/boot/css/bootstrap.min.css">

</head>
<body onload = "onbodyload();">
    <div class="">
        <a href="/"><img class="" src="https://avatars1.githubusercontent.com/u/62701807?s=400&u=eea0499fb9701b4f776b4ceb118db08103826d4e&v=4" alt="hkjsadh" width="5%" height=""></a>
        <nav class="my-2 my-md-0 mr-md-3">
            <button id="log_in_out" type = "button" onclick = 'window.location.href = "login.html"'>로그인</button>
            <button id = "btn_join" type = "button" onclick = 'window.location.href = "join.html"'>회원가입</button>
            <button id = "writequestion" type = "button" onclick = 'window.location.href = "writequestion.html"'>글쓰기</button>

        </nav>
    </div>

    <div class="container">
        <div class="text-center">
            <form style="display: inline;" class="">
                  <input style="width: 400px;" class="" type="text" placeholder="검색할 정보를 입력하세요" aria-label="Search">
                  <button class="" type="submit">검색</button>
            </form>
        </footer>
    </div>

    <!--<div class="container">
        <div class="text-center">
            <div class = "search_frame">
                <input id="google" class = "search_bar" type="text" placeholder="검색할 정보를 입력하세요" aria-label="Search">
                <!--<button type = "button" onclick = "search();" class = "help"><span>구글검색</span></button>
                <span class = "search_button" onclick = "search();">

                </span>
                <span class = "search_icon"onclick = "search();">
                        
                </span>
            </div>
            <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
            <script>
                
                function search(){
                    var google = $('#google').val();
                    window.open('https://www.google.com/search?q=' + google)
                }
            </script>
        </footer>
    </div> -->
    <div id = "questions">
    </div>
    <div id="main">
        <div id="view_q">

        </div>
        <table id="q_table" class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">글쓴이</th>
                <th scope="col">질문</th>
                <th scope="col">주제</th>
              </tr>
            </thead>
            <tbody id="q_list">
                <!--
              <tr>
                <th scope="row">1</th>
                <td>Mark</td>
                <td>Otto</td>
                <td>@mdo</td>
              </tr>
              <tr>
                <th scope="row">2</th>
                <td>Jacob</td>
                <td>Thornton</td>
                <td>@fat</td>
              </tr>
              <tr>
                <th scope="row">3</th>
                <td>Larry</td>
                <td>the Bird</td>
                <td>@twitter</td>
              </tr>-->
            </tbody>
          </table>
    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src = "../public/js/jquery.cookie.js"></script>
    <script src = "../public/js/cutil.js"></script>    
    <script>
        function onbodyload(){
            var userEmail = $.cookie("userEmail");
            if(userEmail != '' && userEmail != null){
                console.log("쿠키 존재: " + userEmail);

                $("#log_in_out").html("로그아웃");
                $("#log_in_out").css("color", "#4fee30");
                $("#log_in_out").attr("onclick", 'window.location.href = "logout"');
                var username = $.cookie("username");
                $("#btn_join").html(username);
                var t = document.getElementById("btn_join");
                t.style.color = "red";
                $("#btn_join").attr("onclick", '');
            }
            else{
                console.log("쿠키가 존재하지 않습니다");

                $("#log_in_out").html("로그인");
                $("#log_in_out").attr("onclick", 'window.location.href = "login.html"');
            }



            var ajaxData = { 
                type: "GET", 
                url : "get_questions",
                data: {}, 
                dataType: "json", 
                success :  function(data, status, xhr){
                    console.log(data);

                    
                    //$("#questions").html("daflasdhfkadhfakds");
                    var tempStr = "";
                    data.forEach(function(item, index){
                        tempStr += "<tr onclick='ViewQuestion(" + item.id + ")'>";
                        tempStr += '<th scope="row">' + item.id + '</th>';
                        tempStr += "<td>" + item.name + "</td>";
                        tempStr += "<td>" + item.title + "</td>";
                        tempStr += "<td>" + item.category + "</td>";
                        tempStr += "</tr>"
                    });

                    $("#q_list").html(tempStr);

                },
                error:  function(jqXHR, textStatus, errorThrown){

                }
            };

            $.ajax( ajaxData );
        }

        function ViewQuestion(id){
            console.log(`질문: ` + id);

            var ajaxData = { 
                type: "GET", 
                url : "view_question",
                data: {id: id}, 
                dataType: "json", 
                success :  function(data, status, xhr){
                    console.log(data);

                    $('#q_table').html('');

                    var question_info = "<br>제목: <input id='title' size=50 value='" + data.title + "'>" + "<br><br>";
                    question_info += "내용: <textarea id='content' rows=4 cols=100>" + data.content+ "</textarea>";
                    question_info += "<br><br><br><br><br>";
                    question_info += "<button onclick=window.location.href='/'>목록으로</button>";
                    question_info += cutil.format("<button class = 'edit' onclick = edit({1})>수정하기</button>", data.id);
                    question_info += cutil.format("<button class = 'delete' onclick = delete_question({1})>삭제하기</button>", data.id);
                    question_info += "<br><br><br><br><br>";
                    question_info += cutil.format("댓글: <textarea id='comment' rows=3 cols=100>{1}</textarea>", data.comment);
                    question_info += cutil.format("<button class = 'comment' onclick = comment({1})>댓글달기</button>", data.id);

                    $('#view_q').html(question_info);
                },
                error:  function(jqXHR, textStatus, errorThrown){

                }
            };

            $.ajax( ajaxData );
        }

        function edit(id){
            // var c = $('#content').val(); //jquery를 사용할 경우
            var c = document.getElementById("content").value;
            var ajaxData = { 
                type: "GET", 
                url : "modify_question",
                data: {id: id, content: c}, 
                dataType: "json", 
                success :  function(data, status, xhr){
                    console.log(data);
                    alert(data.message);
                    window.location.href = "lesson.html";
                },
                error:  function(jqXHR, textStatus, errorThrown){

                }
            };
            $.ajax(ajaxData);
        }

        function delete_question(id){
            var ajaxData = {
                type: "GET",
                url: "delete",
                data: {id: id},
                dataType: "json",
                success: function(data, status, xhr){
                    console.log(data)
                    alert(data.message);
                    window.location.href = "lesson.html";
                }
            };
            $.ajax(ajaxData);
        }

        function comment(id){
            var comments = document.getElementById("comment").value;
            var ajaxData = {
                type: "GET",
                url: "write_comment",
                data: {comments: comments, id: id},
                dataType: "json",
                success: function(data, status, xhr){
                    console.log(data)
                    alert(data.message);
                    window.location.href = "lesson.html";
                }
            }
            $.ajax(ajaxData)
        }
    </script>

</body>
</html>